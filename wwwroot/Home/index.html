<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Список прихода товаров</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.0/css/bootstrap.min.css" rel="stylesheet" />
    <script src="../src/js/clearHostView.js"></script>
</head>

<body>
    <h2>Список прихода товаров</h2>
    <form name="userForm">
        <div class="panel-body">
            <button type="button" id="reload" class="btn btn-primary" onclick="GetProducts()">Обновить</button>
        </div>
    </form>
    <table class="table table-condensed table-striped">
        <thead>
            <tr>
                <th>№ прихода</th>
                <th>№ ТТН</th>
                <th>Наименование</th>
                <th>Артикул</th>
                <th>Количество</th>
                <th>Годен до</th>
                <th>Цена закупки</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <script>
        async function GetProducts() {
            let response = await fetch("https://ychet-tovarov.somee.com/api/ArrivalProducts", {
                method: "GET",
                headers: { "Accept": "application/json" },
            })

            if (response.ok == true) {
                let arrivals = await response.json()
                let table = document.querySelector("tbody")
                table.querySelectorAll("tr").forEach(x => x.remove())
                arrivals.forEach(arrival => {
                    var row = table.insertRow(0);
                    row.insertCell().innerHTML = arrival.id
                    row.insertCell().innerHTML = arrival.note.id
                    row.insertCell().innerHTML = arrival.product.name
                    row.insertCell().innerHTML = arrival.product.idName
                    row.insertCell().innerHTML = arrival.count + " " + arrival.product.unit.name
                    row.insertCell().innerHTML = new Date(arrival.validUntil).toLocaleDateString()
                    row.insertCell().innerHTML = Intl.NumberFormat("ru-RU", { style: "currency", currency: "RUB" }).format(arrival.purchaseCost)
                })
            }
        }

        GetProducts()
    </script>
</body>

</html>